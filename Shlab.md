### Shlab

​	这个lab需要实现一个简单的shell程序，在tsh.c文件中补充完整相关函数。难点是并发控制，各函数的功能分配，作业调度等。

#### 知识点

##### 1）关于进程，进程组，作业

​	进程调度由操作系统实现，作业调度以进程调度为基础在shell中实现。

​	一个进程只属于一个进程组。

##### 2）Linux信号

​	一种软件形式的异常，允许内核和进程中断其他进程，用于实现进程间消息传递，协调控制等。

#####3）fork()函数

​	需要注意的主要特点：调用一次，返回两次，一次返回到父进程，一次返回到子进程，返回值不同。用于实现对子进程分配独立任务。

##### 4）竞争(race)——同步错误

​	合理使用sigprocmask函数阻塞和解除阻塞特定的信号，以消除竞争。

#### 实现

##### 1）eval函数

​	在图8-24中不完整的eval函数基础上，进行修改。重点是：用setpid函数建立新的进程组，以及在合适位置插入sigprocmask函数避免竞争。

#####2）builtin_command函数

​	接收到正确的bg <job>或fg <job>命令时，转入do_bgfg函数。

##### 3）do_bgfg函数

​	需注意如果是fg <job>命令则转入waitfg函数。

##### 4）waitfg函数

​	根据文档中的指示，使用了一个循环，在循环中设置sleep函数，并且为了在某些fforeground进程被外部信号停止或终止时，sigchld_handler函数依旧能被通知到，循环里还加入了一个额外的signal函数用于发信号。

##### 5）sigchld_handler函数

​	使用waitpid函数配合宏，回收子进程。

##### 6）sigint_handler函数

​	使用kill函数转发信号给foreground job。

##### 7）sigtstp_handler函数

​	注意更改作业状态。

#### 总结

​	本实验较其他实验稍繁琐，各种信号的处理方式不唯一。需依据16个traces依次调试。











